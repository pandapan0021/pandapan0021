<!doctype html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Pandapan0021">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Pandapan0021">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pandapan0021">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Panda-pan'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Pandapan0021 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Pandapan0021</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-github">
          <a href="https://github.com/pandapan0021" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github"></i> <br />
            
            Github
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/30/Import-hook/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/30/Import-hook/" itemprop="url">
                  Import-hook
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-30T13:53:47-04:00">
                2017-07-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.python.org/dev/peps/pep-0302/" target="_blank" rel="external">PEP302</a></p>
<p>正如PEP302中所说，在没有导入钩子机制之前，只能通过重写<strong>import</strong>函数的方法来个性化导入行为。<br>而重写<strong>import</strong>会遇到很多的问题。首当其冲的两个问题就是：</p>
<ol>
<li>需要从头实现一个完整的导入系统，或在代码中调用原始的<strong>import</strong>函数。</li>
<li>即使是一些已经在sys.modules中的模块也会调用<strong>import</strong>。</li>
</ol>
<p>还有当希望用c来拓展导入系统时问题就更多了。</p>
<h2 id="The-Importer-Protocol"><a href="#The-Importer-Protocol" class="headerlink" title="The Importer Protocol"></a>The Importer Protocol</h2><p>当读入导入语句之后，解释器在内置命名空间中查看<strong>import</strong>函数。<strong>import</strong>函数将通过四个参数被<br>调用，其中包含将要导入的模块名，和当前全局命名空间的引用。</p>
<p>内置<strong>import</strong>函数紧接着查看当前模块是一个包还是包中的子模块。如果是在包内，它首先做对于当前<br>包的相对导入操作，比如，如果在包’spam’中’import eggs’，将首先查找’spam.eggs’模块名。如果查找<br>失败，将继续做绝对导入–查找名为eggs的模块。</p>
<p>深入此机制，点分隔名的导入依靠它的构成而分开。对于’import spam.ham’，首先’import spam’执行，<br>仅当它成功之时，’ham’才作为’spam’子模块导入。</p>
<p>导入器协议既作用在此分开导入的层面上。当导入器收到一个’spam.ham’的请求，且’spam’已经导入的<br>时间点上。</p>
<p>导入器协议促发两个对象，分别是 finder、loader。查找器对象有一个方法：</p>
<pre><code>finder.find_module(fullname, path=None)
</code></pre><p>此方法将用模块的完整名称作为参数调用。如果查找器被安装在sys.meta_path中，它收到的第二个参数<br>对于不同模块具有不同的值，（如果是顶层模块则为None，子模块或子包为package.<strong>path</strong>）。当模<br>块找到时此方法必须返回一个载入器，未找到则返回None。如产生异常则向上传递给调用者，终止导入。</p>
<p>载入器有一个方法：</p>
<pre><code>loader.load_module(fullname)
</code></pre><p>此方法返回导入的模块或者抛出异常。</p>
<p>在很多情况下，查找器和载入器可以是同一个对象（finder.find_module()返回self）。</p>
<p>两个方法中的fullname参数是模块的全名，如’spam.eggs.ham’。如上所述，当finder.find_module(‘spam.eggs.ham’)<br>被调用，且’spam.eggs’已经导入并加入到sys.modules中。但是，在实际导入时find_module()方法并不是总会被调用<br>分析导入依赖的工具不真正导入模块，所以查找器不必需要父包已经在sys.modules中。</p>
<p>load_module()方法有几个职责必须在执行任意代码之前完成。</p>
<ol>
<li>如果sys.modules中已经存在一个名为fullname的对象，载入器必须使用已经存在的模块。如不存在则<br>创建新对象，并加入sys.modules中。</li>
</ol>
<blockquote>
<p>在载入器执行模块代码之前，模块必须已经加入到sys.modules中。因为模块可能导入自己本身，提前加入<br>sys.modules中可以防止递归。</p>
</blockquote>
<p>当载入失败时，载入器移除加入到sys.modules中的模块。</p>
<ol>
<li><p><strong>file</strong>属性必须设定。</p>
</li>
<li><p><strong>name</strong>属性必须设定。</p>
</li>
<li><p>如果是包，<strong>path</strong>必须设定。</p>
</li>
<li><p><strong>loader</strong> 属性必须设定为载入器。</p>
</li>
<li><p><strong>package</strong>属性必须设定。</p>
</li>
</ol>
<p>如果模块是Python模块，载入器必须在模块的全局命名空间中执行模块的代码。（module<strong>dict</strong>）。</p>
<h2 id="Registering-Hooks"><a href="#Registering-Hooks" class="headerlink" title="Registering Hooks"></a>Registering Hooks</h2><p>有两种类型的导入钩子：Meta hooks和Path hooks。Meta hooks在导入的开始阶段调用，在任何导入<br>程序执行之前。简单把查找器对象加入到sys.meta_path中就注册了一个meta hook。</p>
<p>Path hooks作为sys.path程序的一部分被调用，当相关路径被读入的时刻。将一个载入器工厂函数<br>加入sys.path_hooks中就注册了一个path hook。</p>
<p>sys.path_hooks是一个可调用对象列表，它顺序测试来决定它是否能处理给定的路径。可调用对象<br>使用路径元素为参数调用。如成功调用返回一个导入器对象，否则抛出ImportError异常。</p>
<blockquote>
<p>如果对于特定的sys.path入口返回了导入器对象，内置导入机制将不会触发来处理此入口，即使导入<br>器对象稍后失败了，也不会触发。</p>
</blockquote>
<p>可调用对象是实现import hook的类，因此该类的<strong>init</strong>()方法被调用。</p>
<p>path hook的结果将缓存在sys.path_importer_cache中，该缓存是一个字典。</p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p><a href="https://thehackerguidetopython.com/" target="_blank" rel="external">THE HACKER’S GUIDE TO PYTHON</a>中作者展示了使用导入钩子<br>的场景。</p>
<p>在python源代码中通过自定义的导入期导入Hy源代码文件（.hy文件）。</p>
<blockquote>
<p>Hy是Python上的Lisp实现。<br>Hy将把源代码解析并编译成Python抽象语法树。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/18/python-ast/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/18/python-ast/" itemprop="url">
                  python-ast
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-18T08:36:10-04:00">
                2017-06-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="AST"><a href="#AST" class="headerlink" title="AST"></a>AST</h1><p>抽象语法树是源代码的抽象语法结构的树状表现形式。<a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank" rel="external">Wiki</a></p>
<h1 id="从源码到AST"><a href="#从源码到AST" class="headerlink" title="从源码到AST"></a>从源码到AST</h1><p>python中有两种方法得到AST</p>
<h2 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h2><pre><code>compile(source, filename, mode, flags=0, dont_inherit=False, optimize=-1)
</code></pre><p>当flags=ast.PyCF_ONLY_AST时此函数返回抽象语法树。</p>
<h2 id="ast-module"><a href="#ast-module" class="headerlink" title="ast module"></a>ast module</h2><pre><code>ast.parse(source, filename=&apos;&lt;unknown&gt;&apos;, mode=&apos;exec&apos;)
</code></pre><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><pre><code>import ast

source = &apos;s = 6 + 8&apos;
node = ast.parse(source, mode=&apos;exec&apos;)

print ast.dump(node)
</code></pre><p>输出如下</p>
<pre><code>Module(body=[
    Assign(targets=[Name(id=&apos;s&apos;, ctx=Store())],
           value=BinOp(left=Num(n=6),
                       op=Add(),
                       right=Num(n=8)))
            ])
</code></pre><p>得到ast之后可以使用以下方法执行代码</p>
<pre><code>codeobj = compile(node, filename=&apos;&lt;ast&gt;&apos;, mode=&apos;exec&apos;)

exec(codeobj)
</code></pre><h2 id="Example2"><a href="#Example2" class="headerlink" title="Example2"></a>Example2</h2><p>在python中，1/3被转化为浮点数，但是浮点数并不能准确表示1/3，现在我们使用ast将1/3<br>表示成自定义类Fraction的实例。</p>
<pre><code>class Fraction(object):
    def __init__(self, numerator， denominator):
        self.numerator = numerator
        self.denominator = denominator

    def __str__(self):
        return &quot;Fraction a=%s, b=%s&quot; %(str(a), str(b))

from ast import NodeTransformer, \
        Div, Num, Name, Call, Load, \
        parse, fix_missing_locations

source = &apos;a = 1/3&apos;

ast_tree = parse(source)

class FractionTransformer(NodeTransformer):
    def visit_BinOp(self, node):
        if insinstance(node.op, Div):
            n = Num(node.left.n)
            d = Num(node.right.n)
            return Call(func=Name(id=&apos;Fraction&apos;, \
                    ctx=Load()), args=[n, d], keywords=[], \
                    starargs=Node, kwargs=None)

FractionTransformer().visit(ast_tree)
fix_missing_locations(ast_tree)

exec(compile(ast_tree, &apos;&lt;ast&gt;&apos;, &apos;exec&apos;))

print a
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/12/linux-completion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/12/linux-completion/" itemprop="url">
                  linux-completion
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-12T13:03:04-04:00">
                2017-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>现代shell都内置了命令不全功能，通常通过 <em>TAB</em> 键触发。<br>自动补全可以用来补全 <em>PATH</em> 目录下的命令、文件名、目录<br>名。</p>
<p>现在shell已经可以用来补全命令的参数，比较著名的支持此<br>功能的shell有，<em>zsh</em>，<em>bash</em>。</p>
<p>在Debian系的系统中bash提供了命令行不全文件/etc/bash_completion,</p>
<p>如果系统中含有该文件但是使用TAB无法补全参数，可以使用如下命令：</p>
<pre><code>Linux@linux:~$ . /etc/bash_completion 
</code></pre><p>补全功能需要使用多个内部bash命令，不如complete。想要对默认的<br>completion进行拓展可以简单的创建一个补全文件，并放入<br>/etc/bash_completion.d/文件夹中。</p>
<p>当载入bash_completion文件时，所有bash_completion.d文件夹中的文件<br>都将被载入，使得加入自定义补全很容易。</p>
<p>以补全hostnames为例，当使用VNC远程管理多个主机时，需要使用如下命令：</p>
<pre><code>Linux@linux:~$ xvncviewer hostname
</code></pre><p>为了使得bash可以为了xvncviewer自动补全hostname参数。我们使用如下<br>命令让bash知道xvncviewer需要hostname参数：</p>
<pre><code>Linux@linux:~$ complete -F _known_hosts xvncviewer
</code></pre><p>现在就可以使用TAB对hostname参数进行补全了。</p>
<p>其中_known_hosts 在bash_completion中定义。</p>
<h2 id="自定义completion"><a href="#自定义completion" class="headerlink" title="自定义completion"></a>自定义completion</h2><h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><p>假设我们有一个命令foo，包含三个参数：</p>
<ul>
<li><p>–help</p>
<ul>
<li>显示帮助选项并退出</li>
</ul>
</li>
<li><p>–version</p>
<ul>
<li>显示版本号并退出</li>
</ul>
</li>
<li><p>–verbose</p>
<ul>
<li>以verbose指定的方式运行foo</li>
</ul>
</li>
</ul>
<p>为了处理这些参数，首先创建/etc/bash_completion.d/foo文件。<br>文件内容如下：</p>
<pre><code>_foo()
{
    local cur prev opts
    COMPREPLY=()
    cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
    prev=&quot;${COMP_WORDS[COMP_WORD-1]}&quot;
    opts=&quot;--help --verbose --version&quot;

    if [[ ${cur} == -* ]]
    then
        COMPREEPLY=( $(compgen -W &quot;${opts}&quot; -- ${cur}) )
        return 0
    fi
}
complete -F _foo foo
</code></pre><p>测试程序foo:</p>
<pre><code>#!/usr/bin/env python
from argparse import ArgumentParser

parser = ArgumentParser(prog=&quot;foo&quot;, usage=&quot;%(prog)s [options]&quot;)
parser.add_argument(&apos;--version&apos;, action=&quot;store_true&quot;, default=False, help=
                   &quot;show version&quot;)
parser.add_argument(&apos;--verbose&apos;, action=&quot;store&quot;, dest=&quot;verbose&quot;, nargs=1)

args = parser.parse_args()

if args.version:
    return &quot;V1.0.0&quot;
elif args.verbose:
    return &quot;Run with %s&quot; % args.verbose
else:
    parser.print_help()
</code></pre><h1 id="命令补全工作过程："><a href="#命令补全工作过程：" class="headerlink" title="命令补全工作过程："></a>命令补全工作过程：</h1><p>上例中提供了一个简单的bash函数来处理命令补全。</p>
<p>首先此函数定义了一些局部变量，<br>cur保存现在已经的被输入的词，prev保存之前输入的词，opts提供需要补全的选项。</p>
<p>之后使用compgen命令生成补全列表：</p>
<pre><code>COMPREPLY=( $(compgen -W &quot;${opts}&quot; -- ${cur}) )
</code></pre><p>compgen会根据用户输入的词来生成合适的补全列表，再把此列表赋值给COMPREPLY变量，<br>COMPREPLY是一个特殊的变量，命令补全将使用它来表示将要输出的补全候补。</p>
<p>从<a href="http://www.gnu.org/software/bash/manual/bash.html" target="_blank" rel="external">bash reference manual</a>中对<br>COMPREPLY有详细的描述。</p>
<h2 id="python实现completion"><a href="#python实现completion" class="headerlink" title="python实现completion"></a>python实现completion</h2><p>在django中实现了completion，原理就是根据调用的环境不同，使用两个不同的方式执行命令。</p>
<pre><code>class Command:
    def __init__(self, argv=None):
        self.argv = argv or sys.argv[:]

    def complete(self):
        if &apos;AUTO_COMPLETE&apos; not in os.environ:
            return
        cwords = os.environ[&apos;COMP_WORDS&apos;]
        cword = int(os.environ[&apos;COMP_CWORD&apos;])

        try:
            curr = cowrds[cword]
        except IndexError:
            curr = &apos;&apos;

        options = [&apos;--help&apos;, &apos;--version&apos;, &apos;--verbose&apos;]

        print(&apos; &apos;.join(sorted(filter(lambda x: x.startswith(curr), options))))

        sys.exit(0)

    def execute(self):
        self.complete()

        print(&quot;execute !!!&quot;)

if __name__ == &apos;__main__&apos;:
    com = Command()
    com.execute()
</code></pre><p>completion script:</p>
<pre><code>_py_completion(){
    COMPREPLY=( $( COMP_WORDS=&quot;${COMP_WORDS[*]}&quot; \
                   COMP_CWORD=$COMP_CWORD \
                   AUTO_COMPLETE=1 $1 ) )
}

complete -F _py_completion -o default manage
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/24/Python-DOC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/24/Python-DOC/" itemprop="url">
                  Python-DOC
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-24T10:06:03-04:00">
                2017-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Docstring结构"><a href="#Docstring结构" class="headerlink" title="Docstring结构"></a>Docstring结构</h1><h2 id="package-docstring"><a href="#package-docstring" class="headerlink" title="package-docstring"></a>package-docstring</h2><p>modules exported<br>subpackages exported</p>
<h2 id="module-docstring"><a href="#module-docstring" class="headerlink" title="module-docstring"></a>module-docstring</h2><p>classes exported<br>exceptions exported<br>functions exported</p>
<h2 id="class-docstring"><a href="#class-docstring" class="headerlink" title="class-docstring"></a>class-docstring</h2><p>summarize behavior<br>public methods<br>instance variables</p>
<p>subclass interface</p>
<h2 id="subclass-docstring"><a href="#subclass-docstring" class="headerlink" title="subclass-docstring"></a>subclass-docstring</h2><p>use the verb “override” to indicate replace<br>use the verb “extend” to indicate enhance</p>
<h1 id="Low-level-syntax"><a href="#Low-level-syntax" class="headerlink" title="Low-level-syntax"></a>Low-level-syntax</h1><h2 id="literals"><a href="#literals" class="headerlink" title="literals"></a>literals</h2><p>double-backquotes <code>literals</code> (inline)<br>double colon :: literals (block)</p>
<h2 id="doctest"><a href="#doctest" class="headerlink" title="doctest"></a>doctest</h2><pre>
>>> cmdline command
result
>>> cmd
result

</pre>

<h2 id="identifier"><a href="#identifier" class="headerlink" title="identifier"></a>identifier</h2><p>enclosed in single backquotes</p>
<h2 id="identifier’s-role"><a href="#identifier’s-role" class="headerlink" title="identifier’s role"></a>identifier’s role</h2><p>enclose in colon (:role:)</p>
<h2 id="lists"><a href="#lists" class="headerlink" title="lists"></a>lists</h2><p>*. line<br>  +. line<br>    -. line</p>
<h2 id="directives-and-substitutions"><a href="#directives-and-substitutions" class="headerlink" title="directives and substitutions"></a>directives and substitutions</h2><ol>
<li><p>.. image:: mylogo.png</p>
</li>
<li><p>The |biohazard| symbol</p>
<p>.. |biohazard| image:: biohazard.png</p>
</li>
</ol>
<h2 id="section-title"><a href="#section-title" class="headerlink" title="section title"></a>section title</h2><pre>
This is a Section Title
==========================

This is a Subsection Title
---------------------------------

</pre>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/12/decorator方式使用flask-admin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/12/decorator方式使用flask-admin/" itemprop="url">
                  decorator方式使用flask-admin
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-12T15:25:38-04:00">
                2017-04-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="flask-admin"><a href="#flask-admin" class="headerlink" title="flask-admin"></a>flask-admin</h1><pre><code>from flask import Flask
from flask_admin import Admin
from flask_admin.contrib.sqla import ModelView
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
db = SQLAlchemy(app)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True)

admin = Admin(app, name=&apos;test&apos;, template_mode=&apos;bootstrap3&apos;)

admin.add_view(ModelView(User, db.session))
</code></pre><p>正常的使用集中管理admin的视图，与flask的思想向抵触，以下转化为更flask的风格。</p>
<pre><code>from flask import Flask
from flask_admin import Admin
from flask_admin.contrib.sqla import ModelView
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
db = SQLAlchemy(app)
admin = Admin(app, name=&apos;test&apos;, template_mode=&apos;bootstrap3&apos;)

def add_view(admin_instance, model_view=ModelView, db=db):
    def wrap(_cls):
        admin_instance.add_view(model_view(_cls, db.session))
        return _cls
    return wrap

@add_view(admin, ModelView, db)
class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True)
</code></pre><p>这只是妥协的做法。<br>更优雅的做法为：</p>
<pre><code>from flask_admin import Admin as _Admin

class Admin(_Admin):
    def __init__(self, *args, **kwargs):
        self.db = kwargs.pop(&apos;_db&apos;, None)
        super(Admin, self).__init__(*args, **kwargs)

    def _add_view(self, model_view=ModelView, db=None):
        if db == None:
            db = self.db
        def wrap(_cls):
            self.add_view(model_view(_cls, db.session))
            return _cls
        return wrap
</code></pre><p>之后可以用一下的方式调用</p>
<pre><code>db = SQLAlchemy(app)
admin = Admin(app, name=&apos;test&apos;, template_mode=&apos;bootstrape&apos;, _db=db)

@admin._add_view(ModelView)
class User(db.Model):
    ......
</code></pre><p>这样就更flask了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/04/dynamic-programming/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/04/dynamic-programming/" itemprop="url">
                  dynamic-programming
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-04T11:24:07-04:00">
                2017-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>对于遇到的问题，如果该问题可以被拆分成更小的子问题，子问题又分解成更小的子问题。同时在这个<br>过程中发现有重叠的只问题出现，就意味着该问题可以用动态规划来求解。同时，子问题的最优解将对<br>所遇问题最优解的计算有所帮助。</p>
<p>对符合上述条件的问题有两种方法处理：</p>
<ul>
<li>至上而下：从给定问题开始拆分子问题， 如果只问题已被解决就返回保存的结果，如果未被解决这<br>解决该子问题并保存结果。(Memoization技术)</li>
<li>自底向上：分析问题，弄清子问题求解的顺序，从最先求解的只问题开始计算，向上求解到说给的<br>保证子问题都在所给问题之前被解决。(Dynamic Programming)</li>
</ul>
<blockquote>
<p>动态规划于分治法的区别在于子问题的重叠性，分治法要求所分解出来的子问题为非重叠的可独立<br>求解的子问题。归并排序与快速排序为典型的分治法。</p>
<p>与动态规划互补的算法为贪婪算法，贪婪算法在每次需要选择是都做出一个决定，通过这种算法来<br>得到近似最优解。动态规划算法是基于数学归纳法的。贪婪算法需要其他的方法来证明。</p>
</blockquote>
<h2 id="示例-Minimum-Steps-to-One"><a href="#示例-Minimum-Steps-to-One" class="headerlink" title="示例:Minimum Steps to One"></a>示例:Minimum Steps to One</h2><p>对于正整数，你可以做下列任意三个动作之一：</p>
<ul>
<li>减1</li>
<li>如果能被2整除，则可除2</li>
<li>如果能被3整除，则可除3</li>
</ul>
<p>现给定一个正整数n，求出使n到达1的最少步数。</p>
<blockquote>
<p>例：</p>
<ol>
<li>n = 1, output:0</li>
<li>n = 4, output:2 (4/2=2 2/2=1)</li>
<li>n = 7, output:3 (7-1=6 6/3=2 2/2=1)</li>
</ol>
</blockquote>
<h3 id="Idea"><a href="#Idea" class="headerlink" title="Idea"></a>Idea</h3><p>当整数为n时，所用最少步数为F(n)。如果n=1，则F(n)=0，否则F(n) = 1 + min(F(n-1), F(n/2), F(n/3))<br>考察子问题可以发现有重叠子问题，且问题最优解依赖于子问题的最优解。</p>
<h3 id="至上而下"><a href="#至上而下" class="headerlink" title="至上而下"></a>至上而下</h3><pre><code>meno = []
for i in range(n+1):
    meno.append(-1)

def getMinSteps(n):
    if n==1:
        return 0
    if memo[n] != -1:
        return memo[n]
    r = 1 + getMinSteps(n-1)
    if n%2 == 0:
        r = min(r, 1+getMinSteps(n/2)
    if n%3 == 0:
        r = min(r, 1+getMinSteps(n/3)
    menmo[n] = r
    return r
</code></pre><h3 id="自底向上"><a href="#自底向上" class="headerlink" title="自底向上"></a>自底向上</h3><pre><code>def getMinSteps(n):
    dp = []
    for i in range(n+1):
        dp.append(0)
    for i in range(2, n+1):
        dp[i] = 1 + dp[i-1]
        if i%2==0:
            dp[i] = min(dp[i], 1+dp[i/2])
        if i%3==0:
            dp[i] = min(dp[i], 1+dp[i/3])
    return dp[n]
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/03/sql-join-on-and-where-diff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/03/sql-join-on-and-where-diff/" itemprop="url">
                  sql-join-on-and-where-diff
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-03T14:26:44-04:00">
                2017-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="INNER-JOIN-ON-与-where"><a href="#INNER-JOIN-ON-与-where" class="headerlink" title="INNER JOIN ON 与 where"></a>INNER JOIN ON 与 where</h1><h2 id="示例数据"><a href="#示例数据" class="headerlink" title="示例数据"></a>示例数据</h2><h3 id="Employee-table"><a href="#Employee-table" class="headerlink" title="Employee table"></a>Employee table</h3><table>
<thead>
<tr>
<th>LastName</th>
<th>DepartmentID</th>
</tr>
</thead>
<tbody>
<tr>
<td>Refferty</td>
<td>31</td>
</tr>
<tr>
<td>jones</td>
<td>33</td>
</tr>
<tr>
<td>Heisenberg</td>
<td>33</td>
</tr>
<tr>
<td>Robinson</td>
<td>34</td>
</tr>
<tr>
<td>Smith</td>
<td>34</td>
</tr>
<tr>
<td>Williams</td>
<td>NULL</td>
</tr>
</tbody>
</table>
<h3 id="Department-table"><a href="#Department-table" class="headerlink" title="Department table"></a>Department table</h3><table>
<thead>
<tr>
<th>DepartmentID</th>
<th>DepartmentName</th>
</tr>
</thead>
<tbody>
<tr>
<td>31</td>
<td>Sales</td>
</tr>
<tr>
<td>33</td>
<td>Engineering</td>
</tr>
<tr>
<td>34</td>
<td>Clerical</td>
</tr>
<tr>
<td>35</td>
<td>Marketing</td>
</tr>
</tbody>
</table>
<p>数据取自wiki<a href="https://en.wikipedia.org/wiki/Join_%28SQL%29" target="_blank" rel="external">wiki</a></p>
<h2 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h2><h3 id="explicit-join-notation"><a href="#explicit-join-notation" class="headerlink" title="explicit join notation"></a>explicit join notation</h3><p>SELECT employee.LastName, employee.DepartmentID, department.DepartmentName<br>FROM employee<br>INNER JOIN department ON<br>employee.DepartmentID = department.DepartmentID;</p>
<h3 id="implicit-join-notation"><a href="#implicit-join-notation" class="headerlink" title="implicit join notation"></a>implicit join notation</h3><p>SELECT employeee.LastName, employee.DepartmentID, department.DepartmentName<br>FROM employee, department<br>WHERE employee.DepartmentID = department.DepartmentID;</p>
<p>得到的视图都是</p>
<table>
<thead>
<tr>
<th>Employee.LastName</th>
<th>Employee.DepartmentID</th>
<th>Department.DepartmentName</th>
</tr>
</thead>
<tbody>
<tr>
<td>Robinson</td>
<td>34</td>
<td>Clerical</td>
</tr>
<tr>
<td>Jones</td>
<td>33</td>
<td>Engineering</td>
</tr>
<tr>
<td>Smith</td>
<td>34</td>
<td>Clerical</td>
</tr>
<tr>
<td>Heisenberg</td>
<td>33</td>
<td>Engineering</td>
</tr>
<tr>
<td>Rafferty</td>
<td>31</td>
<td>Sales</td>
</tr>
</tbody>
</table>
<p>两个sql语句有什么区别呢<br>对于implicit join notation 首先进行cross join然后再执行select .. where子句</p>
<p>对于explicit join notation 首先使用inner join生成缩小范围的表 ， 再在此表上执行select<br><img src="https://www.codeproject.com/KB/database/Visual_SQL_Joins/INNER_JOIN.png" alt="Inner JOIN"><br>图片取自<a href="https://www.codeproject.com/kb/database/visual_sql_joins.aspx" target="_blank" rel="external">codeproject</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/01/sqlalchemy-engine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/01/sqlalchemy-engine/" itemprop="url">
                  sqlalchemy-engine
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-01T05:19:42-04:00">
                2017-04-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="create-engine"><a href="#create-engine" class="headerlink" title="create_engine"></a>create_engine</h1><pre><code>def create_engine(*args, **kwargs):
    strategy = kwargs.pop(&apos;strategy&apos;, default_strategy)
    strategy = strategies.strategies[strategy]
    return strategy.create(*args, **kwargs)
</code></pre><p>default_strategy = ‘plain’</p>
<p>strategies = {‘plain’: PlainEngineStrategy(), ‘threadlocal’: ThreadLocalEngineStrategy(), ‘mock’:..}</p>
<p>以默认策略为例，strategy = PlainEngineStrategy()</p>
<h1 id="strategy-create"><a href="#strategy-create" class="headerlink" title="strategy.create"></a>strategy.create</h1><pre><code>def create(self, name_or_url, **kwargs):

    &quot;&quot;&quot;
    use :arg:`name_or_url` construct URL object
    :cls:`URL`:
        class URL(object):
            dirvername
            username
            password
            host
            port
            database
            query

            :method:
            __tostring__
            get_backend_name
            get_driver_name
            _instantiate_plugins
            _get_entrypoint
            get_dialect
            translate_connect_args
    &quot;&quot;&quot;
    u = url.make_url(name_or_url)
    &apos;&apos;&apos;
    :method:`_instantiate_plugins`
    get plugins in query dict
    &apos;&apos;&apos;
    plugins = u._instantiate_plugins(kwargs)
    u.query.pop(&apos;plugin&apos;, None)

    &apos;&apos;&apos;
    :method:`_get_entrypoint()`
    dirvername -&gt; dialect+driver
    name -&gt; dialect.dirvier
    cls -&gt; registry.load(name)
    -&gt; dialect, driver = name.split(&apos;.&apos;)
    -&gt; module = __import__(&apos;sqlalchemy.dialects.%s&apos;%dialect).dialects
    &gt; __import__函数默认只返回最顶层包
    以mysql为例：module=sqlalchemy.dialects
    -&gt; module = sqlalchemy.dialects.mysql
    -&gt; module = sqlalchemy.dialects.mysql.base
    -&gt; loader =  lambda: sqlalchemy.dialects.mysql.base.dialect
    -&gt; cls = sqlalchemy.dialects.mysql.base.dialect
    entrypoint = cls
    mysql中 base.dialects = mysqldb.dialect
    则 entrypoint = sqlalchemy.dialects.mysql.mysqldb.dialect
    entrypoint = sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb
    &apos;&apos;&apos;
    entrypoint = u._get_entrypoint()

    &apos;&apos;&apos;
    :method:`get_dialect`
    MySQLDialect_mysqldb继承关系：
    sqlalchemy.engine.interfaces.Dialect
                      |
    sqlalchemy.engine.default.DefaultDialect
                      |
    sqlalchemy.dialects.mysql.base.MySQLDialect
                      |
    sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb

    -&gt; interfaces.Dialect.get_dialect(cls, url): return cls
    则 dialect_cls = entrypoint
    &apos;&apos;&apos;
    dialect_cls = entrypoint.get_dialect_cls(u)

    ...

    dialect = dialect_cls(**dialect_args)

    &apos;&apos;&apos;
    :method:`create_connect_args`
    -&gt;opts = url.translate_connect_args(database=&apos;db&apos;, username=&apos;user&apos;,password=&apos;passwd&apos;)
    -&gt;opts = {&apos;host&apos;: url.host, &apos;db&apos;:url.database, &apos;user&apos;:url.username, &apos;passwd&apos;:url.password\
              &apos;port&apos;:url.port}
    -&gt;opts.updata(url.query)
    -&gt;ssl = {&apos;ca&apos;: opts[&apos;ssl_ca&apos;], ...}
    -&gt;opts[&apos;ssl&apos;] = ssl
    -&gt;return [[], opts]
    -&gt; cargs = [] cparams = opts
    (cargs, cparams) = dialect.create_connect_args(u)

    cparams.update(pop_kwarg(&apos;connect_args&apos;, {}))
    cargs = list(cargs)

    &apos;&apos;&apos;
    -&gt;engineclass = sqlalchemy.engine.base.Engine
    &apos;&apos;&apos;
    engineclass = self.engine_cls

    ...

    &apos;&apos;&apos;
    -&gt;engine = sqlalchemy.engine.base.Engine(pool, &apos;mysql&apos;, u, ...)
    &apos;&apos;&apos;
    engine = engineclass(pool, dialect, u, **engine_args)

    &apos;&apos;&apos;
    -&gt; _initialize = True
    -&gt; do_on_connect = dialect.on_connect()(:method:`sqlalchemy.engine.default.DefaultDialect.on_connect`)
    -&gt; do_on_connect = None
    &apos;&apos;&apos;

    ...

    &apos;&apos;&apos;
    sqlalchemy.dialects.mysql.mysqldb.MySQLDialect_mysqldb.engine_created(sqlalchemy.engine.base.Engine())
    &apos;&apos;&apos;
    dialect_cls.engine_created(engine)

    return engine
</code></pre><p>从源码可以看出 engine 的构建过程为，首先从传入的url构造URL对象，确定所使用的数据库、dbapi、传入参数、插件等等信息。<br><img src="http://docs.sqlalchemy.org/en/latest/_images/sqla_engine_arch.png" alt="sqlalchemy-engine"><br>创建engine时sqlalchemy并不会立刻链接数据库，连接发生在第一次数据库相关的操作发生之时。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/24/descriptor与property/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/24/descriptor与property/" itemprop="url">
                  descriptor与property
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-24T22:33:54-04:00">
                2017-03-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="descriptor"><a href="#descriptor" class="headerlink" title="descriptor"></a>descriptor</h1><p>   描述器是指作为对象的属性存在并且定义了__get__,__set__,__delete__方法的对象。<br>   描述器改变了对象属性的默认访问方式。<br>   当访问对象属性时，默认的行为方式如下：<br>a.x -&gt; a.__dict__[‘x’] -&gt; type(a).__dict__[‘x’]…..</p>
<p>当说访问的属性定义了描述器方法的时候，则以如下方式访问：<br>a.x -&gt; x.__get__(a, type(a))<br>a.x = 1 -&gt; x.__set__(a, 1)<br>del a.x -&gt; x.__delete__(a)</p>
<p>当通过类对象而不是实例对象访问时描述器方法的instance参数对None<br>当对象定义了__set__/__delete__中的任意一个或都定义时，此对象为一个数据描述器，数据描述器总是覆盖实例中重新定义的同名属性。如果对象只定义了__get__方法，则它为一个无数据描述器，实例中定义的属性可以覆盖此描述器。</p>
<h1 id="descriptor的应用"><a href="#descriptor的应用" class="headerlink" title="descriptor的应用"></a>descriptor的应用</h1><p>1.staticmethod()</p>
<pre><code>def staticmethod(f):
    class wrap(object):
        def __get__(self, instance, owner):
            return f
    return wrap()
</code></pre><p>这样就实现了一个简单的静态方法包裹函数。<br>2.classmethod()<br>与staticmethod类似</p>
<p>3.property</p>
<p>property函数有两种使用方法<br>方法一、</p>
<pre><code>class C:
    def __init__(self):
        self._x = None
    def getx(self):
        return self._x
    def setx(self, value):
        self._x = value
    def delx(self):
        del self._x
    x = property(getx, setx, delx, &quot;x property&quot;)
</code></pre><p>方法二、</p>
<pre><code>class C:
    def __init__(self):
        self._x = None
    @property
    def x(self):
        return self._x
    @x.setter
    def x(self, value):
        self._x = value
    @x.deleter
    def x(self):
        del self._x
</code></pre><h5 id="class-property-fget-None-fset-None-fdel-None-doc-None-简单实现"><a href="#class-property-fget-None-fset-None-fdel-None-doc-None-简单实现" class="headerlink" title="class property(fget=None, fset=None, fdel=None, doc=None)简单实现"></a>class property(fget=None, fset=None, fdel=None, doc=None)简单实现</h5><pre><code>class property(object):
    def __init__(self, fget=None, fset=None, \
                       fdel=None, doc=None):
        self._fget = fget
        self._fset = fset
        self._fdel = fdel
        self.__doc__ = doc
    def setter(self, f):
        self._fset = f
        return self
    def deleter(self, f):
        self._fdel = f
        return self
    def __get__(self, instance, owner):
        return self._fget(instance)
    def __set__(self, instance, value):
        self._fset(instance, value)
    def __delete__(self, instance):
        self._fdel(instance)
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/12/jinja2-Template/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Panda-pan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pandapan0021">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/12/jinja2-Template/" itemprop="url">
                  jinja2-模板对象
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-12T11:51:28-05:00">
                2017-02-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h6><h6 id="1-Tempalte类为核心模板对象。用来表示编译过的模板文件并用来渲染该模板文件。"><a href="#1-Tempalte类为核心模板对象。用来表示编译过的模板文件并用来渲染该模板文件。" class="headerlink" title="(1) Tempalte类为核心模板对象。用来表示编译过的模板文件并用来渲染该模板文件。"></a>(1) Tempalte类为核心模板对象。用来表示编译过的模板文件并用来渲染该模板文件。</h6><h6 id="2-通常模板对象是从Enviroment-类生成的，但Template-类提供了构造器来生成模板对象。"><a href="#2-通常模板对象是从Enviroment-类生成的，但Template-类提供了构造器来生成模板对象。" class="headerlink" title="(2) 通常模板对象是从Enviroment 类生成的，但Template 类提供了构造器来生成模板对象。"></a>(2) 通常模板对象是从Enviroment 类生成的，但Template 类提供了构造器来生成模板对象。</h6><h6 id="3-从Template类直接生成的模板对象包含一个指向临时环境的”environment”属性，所有由Template类直接生成的模板对象共享这个临时环境。"><a href="#3-从Template类直接生成的模板对象包含一个指向临时环境的”environment”属性，所有由Template类直接生成的模板对象共享这个临时环境。" class="headerlink" title="(3) 从Template类直接生成的模板对象包含一个指向临时环境的”environment”属性，所有由Template类直接生成的模板对象共享这个临时环境。"></a>(3) 从Template类直接生成的模板对象包含一个指向临时环境的”environment”属性，所有由Template类直接生成的模板对象共享这个临时环境。</h6><h6 id="4-new"><a href="#4-new" class="headerlink" title="(4)__new__"></a>(4)__new__</h6><p>args:</p>
<ol>
<li>source: 模板字符串。</li>
<li>block_start_string(默认为 { % )</li>
<li>block_end_string(默认为 % } )</li>
<li>variable_start_string(默认为 { { )</li>
<li>variable_end_string(默认为 } } )</li>
<li>comment_start_string(默认为 { # )</li>
<li>comment_end_string(默认为 # } )</li>
<li>line_statement_prefix(None)</li>
<li>line_comment_prefix(None)</li>
<li>trim_blocks(False)</li>
<li>lstrip_blocks(False)</li>
<li>newline_sequence(默认为 \n )</li>
<li>keep_trailing_newline(False)</li>
<li>extensions</li>
<li>optimized</li>
<li>undefine</li>
<li>finalize</li>
<li>autoescape(此处默认为False，所以从字符串直接构造的模板对象不会自动转义，但是Environment生成的模板对象默认自动转义)</li>
<li>enable_async(False)</li>
</ol>
<p>函数体：<br>通过get_spontaneous_environment生成环境变量env，再通过env.from_string函数生成模板对象。</p>
<p>######(5)from_code<br>此函数从编译过的模板代码和globals参数创建模板对象，供loaders和environment调用。</p>
<p>######(6)from_module_dict<br>此函数通过模块构造模板对象，供module loadder调用</p>
<p>######(7)_from_namespace<br>由from_code与from_module_dict函数调用真正创建模板对象的函数</p>
<p>######(8)render/render_async<br>渲染函数，render_async需要支持await特性的python版本，目前还没有实现。</p>
<p>######(9)stream<br>同generate但是返回TemplateStream的实例</p>
<p>######(10)generate/generate_async<br>对于大规模的模板，此函数可以一条语句接着一条语句渲染并一段一段的生成。异步方法同样需要await支持(未实现)</p>
<pre><code>从几个渲染函数看出，渲染的核心功能由Template.new_context函数与Template.root_render_func函数提供
</code></pre><p>######(11)new_context<br>为模板对象创建上下文环境，为Context类的实例。全局变量默认加入此上下文。</p>
<p>######(12)make_module/make_module_async<br>默认参数下和module方法一致。</p>
<p>######(13)module 调用 _get_default_module 返回self._module<br>由make_module 默认参数构造。</p>
<p>######(14)get_corresponding_lineno 返回行号</p>
<p>######(15)is_up_to_date 检测是否需要更新模板</p>
<p>######(16)debug_info 返回debug信息</p>
<p>####flask调用jinja2过程</p>
<p>######flask/templating.py<br>render_template函数调用_render渲染模板<br>首先，从flask的本地应用上下文栈中取出应用上下文ctx。更新模板环境。<br>ctx.app.jinja_env.get_or_select_template生成模板对象。</p>
<p>######flask/app.py<br>jinja_env调用create_jinja_environment<br>create_jinja_environment首先生成jinja配置选项，通过jinja_environment生成jinja环境，jinja_environment就是flask/templating.py/Evnironment。</p>
<p>######flask/templating.py<br>通过jinja2/environment.py/Environment构造环境</p>
<p>ctx.app.jinja_env就是一个jinja2/environment.py/Environment实例。</p>
<p>######jinja2/environment.py<br>Environment.get_or_select_template<br>如果参数为字符串调用get_template\，否则调用select_template</p>
<p>Environment.select_template<br>通过_load_template生成Template对象</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Panda-pan" />
          <p class="site-author-name" itemprop="name">Panda-pan</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Panda-pan</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
